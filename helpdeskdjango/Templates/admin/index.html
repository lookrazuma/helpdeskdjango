{% extends "admin/base_site.html" %}

<!-- LOADING -->
{% load i18n grp_tags log %}

<!-- JAVASCRIPTS -->
{% block javascripts %}
    {{ block.super }}
{% endblock %}

<!-- COLTYPE/BODYCLASS-- >
{% block bodyclass %}dashboard{% endblock %}
{% block content-class %}content-grid{% endblock %}

<!-- BREADCRUMBS -->
{% block breadcrumbs %}
    <ul class="grp-horizontal-list">
        <li>{% trans "Home" %}</li>
    </ul>
{% endblock %}
{% block content_title %}
    {% if title %}
        <header><h1>{{ title }}</h1></header>
    {% endif %}
{% endblock %}

<!-- CONTENT -->
{% block content %}
    <div id="grp-content-container">
        <div class="g-d-9 g-d-f">
            {% for app in app_list %}
                <div class="grp-module" id="app_{{ app.name|lower }}">
                    <h2><a href="{{ app.app_url }}" class="grp-section">{% trans app.name %}</a></h2>
                    {% for model in app.models %}
                        <div class="grp-row" id="model-{{ model.object_name|lower }}">
                            {% if model.admin_url %}
                                <a href="{{ model.admin_url }}"><strong>{{ model.name }}</strong></a>
                            {% else %}
                                <strong>{{ model.name }}</strong>
                            {% endif %}
                            {% if model.add_url %}
                                <ul class="grp-actions">
                                    <li class="grp-icon grp-add-link">
                                        <a href="{{ model.add_url }}" title="{% trans "Add" %}">&nbsp;</a>
                                    </li>
                                </ul>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% empty %}
                <p>{% trans "You don´t have permission to edit anything." %}</p>
            {% endfor %}
            {% block custom_views %}
                {% if custom_list %}
                    <div class="grp-module" id="custom_views">
                        <h2>{% trans 'Custom Views' %}</h2>
                        {% for path, name in custom_list %}
                            <div class="grp-row">
                                <a href="{{ path }}"><strong>{{ name }}</strong></a>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endblock %}
        </div>
        <div class="g-d-6 g-d-l">
            <div class="grp-module" id="grp-recent-actions-module">
                <h2>{% trans 'Recent actions' %}</h2>
                <div class="grp-module">
                    <h3>{% trans 'My actions' %}</h3>
                    {% get_admin_log 10 as admin_log for_user user %}
                    {% if not admin_log %}
                        <div class="grp-row"><p>{% trans 'None available' %}</p></div>
                    {% else %}
                        <ul class="grp-listing-small">
                            {% for entry in admin_log %}
                                <li class="grp-row{% if entry.is_addition %} grp-add-link{% endif %}{% if entry.is_change %} grp-change-link{% endif %}{% if entry.is_deletion %} grp-delete-link{% endif %}">
                                    {% if entry.is_deletion %}
                                        <span>{{ entry.object_repr }}</span>
                                    {% else %}
                                        <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                                    {% endif %}
                                    <span class="grp-font-color-quiet">{% filter capfirst %}{% trans entry.content_type.name %}{% endfilter %}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>
        </div>
        {% if user.is_superuser %}
        <div class="g-d-20 g-d-l" style="margin-left:20px">
                <div class="text-center grp-module">
                    <h4>Количество заявок по исполнителям</h4>
                    <div>
                    <canvas id="contractor-task-count-chart" data-url="{% url 'contractor-task-count-chart' %}"></canvas>
                    </div>
                </div>
                {% comment %} <div class="row"> {% endcomment %}
                    <div class="col text-center grp-module" >
                    <h4>Ход выполнения</h4>
                    <div>
                        <canvas id="status-task-count-chart" data-url="{% url 'status-task-count-chart' %}"></canvas>
                    </div>
                    </div>
                    <div class="col text-center grp-module">
                    <h4>Количество заявок из отделов</h4>
                    <div>
                        <canvas id="dept-task-count-chart" data-url="{% url 'dept-task-count-chart' %}"></canvas>
                    </div>
                    </div>
                {% comment %} </div> {% endcomment %}
                    <div class="text-center grp-module">
                    <h4>Количество заявок по сотрудникам</h4>
                    <div>
                    <canvas id="author-task-count-chart" data-url="{% url 'author-task-count-chart' %}"></canvas>
                    </div>
                </div>
                {% comment %} <div class="text-center">
                    <h4>Количество заявок по месяцам</h4>
                    <div>
                    <canvas id="month-task-count-chart" data-url="{% url 'month-task-count-chart' %}"></canvas>
                    </div>
                </div>
                <hr> {% endcomment %}
        </div>
        {% endif %}
    </div>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  <script>

    $(function () {

      var $contractorTaskCountChart = $("#contractor-task-count-chart");
      $.ajax({
        url: $contractorTaskCountChart.data("url"),
        success: function (data) {

          var ctx = $contractorTaskCountChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Количество',
                backgroundColor: getRandomColor,
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              }
            }
          });

        }
      });

    });

  </script>
  <script>

    $(function () {

      var $statusTaskCountChart = $("#status-task-count-chart");
      $.ajax({
        url: $statusTaskCountChart.data("url"),
        success: function (data) {

          var ctx = $statusTaskCountChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'pie',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Количество',
                backgroundColor: getRandomColor,
                //illColor: 
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              },
              labels: {
                    fontColor: "blue",
                    fontSize: 18
                }
            }
          });

        }
      });

    });
    function getRandomColor() {
    var letters = '0123456789ABCDEF'.split('');
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
    }
  </script>
    <script>

    $(function () {

      var $deptTaskCountChart = $("#dept-task-count-chart");
      $.ajax({
        url: $deptTaskCountChart.data("url"),
        success: function (data) {

          var ctx = $deptTaskCountChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'polarArea',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Количество',
                backgroundColor: getRandomColor,
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              }
            }
          });

        }
      });

    });

  </script>

      <script>

    $(function () {

      var $authorTaskCountChart = $("#author-task-count-chart");
      $.ajax({
        url: $authorTaskCountChart.data("url"),
        success: function (data) {

          var ctx = $authorTaskCountChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Количество',
                backgroundColor: getRandomColor,
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              }
            }
          });

        }
      });

    });

  </script>

  <script>

    $(function () {

      var $monthTaskCountChart = $("#month-task-count-chart");
      $.ajax({
        url: $monthTaskCountChart.data("url"),
        success: function (data) {

          var ctx = $monthTaskCountChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Количество',
                backgroundColor: getRandomColor,
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              }
            }
          });

        }
      });

    });

  </script>

{% endblock %}
